name: Update README Git Stats Theme

on:
  schedule:
    - cron: '*/1 * * * *' # Runs every minute
  workflow_dispatch: # Allows manual trigger

permissions:
  contents: write
  pull-requests: write

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Update README.md with new themes
        run: |
          # Define themes for GitHub Stats, Streak, and Contribution Graph
          stats_themes=("radical" "dark" "merko" "tokyonight")
          graph_themes=("radical" "dark" "tokyonight" "github")

          # Randomly select themes
          stats_theme=${stats_themes[$((RANDOM % ${#stats_themes[@]}))]}
          graph_theme=${graph_themes[$((RANDOM % ${#graph_themes[@]}))]}

          echo "Selected stats theme: $stats_theme"
          echo "Selected graph theme: $graph_theme"

          # Update GitHub Stats and Streak theme in the <td> HTML block
          sed -i "s|\(https://github-readme-stats\.vercel\.app/api?username=armaaan&[^\"]*theme=\)[^&\"]*|\1$stats_theme|" README.md
          sed -i "s|\(https://github-readme-streak-stats\.herokuapp\.com/\?user=armaaan&[^\"]*theme=\)[^&\"]*|\1$stats_theme|" README.md

          # Update Contribution Graph theme
          sed -i "s|\(https://github-readme-activity-graph\.vercel\.app/graph?username=armaaan&[^\"]*theme=\)[^&\"]*|\1$graph_theme|" README.md

      - name: Commit and push changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add README.md
          git commit -m "Update README.md themes: stats=$stats_theme, graph=$graph_theme"
          git push
